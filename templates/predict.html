<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predict - Fraud Detection</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', sans-serif;
    background: radial-gradient(circle at center, #001a33 0%, #000000 70%);
    min-height: 100vh;
    padding: 40px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    max-width: 1200px;
    width: 100%;
    align-items: center;
}

.form-section {
    background: #0a0f1a;
    padding: 50px;
    border-radius: 20px;
    border: 1px solid rgba(0,170,255,0.4);
    box-shadow: 0 0 40px rgba(0,170,255,0.4);
}

.form-section h1 {
    color: #00aaff;
    margin-bottom: 10px;
    font-size: 28px;
    font-weight: 700;
}

.form-section .subtitle {
    color: #9ccfff;
    margin-bottom: 30px;
    font-size: 14px;
}

label {
    display: block;
    margin-bottom: 8px;
    color: #00ccff;
    font-weight: 600;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

input[type="text"],
input[type="number"],
select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #1a2a40;
    border-radius: 8px;
    font-size: 14px;
    background: #111827;
    color: white;
    transition: 0.3s ease;
}

input::placeholder {
    color: #6b91b3;
}

input:focus,
select:focus {
    outline: none;
    border-color: #00aaff;
    box-shadow: 0 0 10px #00aaff;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.button-group {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

button {
    flex: 1;
    padding: 14px 20px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s ease;
    text-transform: uppercase;
}

/* BLUE BUTTON */
.btn-submit {
    background: linear-gradient(45deg, #007bff, #00aaff);
    color: white;
    border: none;
    box-shadow: 0 0 15px #00aaff;
}

.btn-submit:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 25px #00aaff;
}

.btn-reset {
    background: transparent;
    color: white;
    border: 1px solid #00aaff;
}

.btn-reset:hover {
    background: #001f33;
}

/* GRAPHICS */
.graphics-section {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    grid-column: 2;
}

.security-icon {
    width: 300px;
    height: 300px;
    display:flex;
    align-items:center;
    justify-content:center;
    animation: float 3s ease-in-out infinite;
}

.security-icon img {
    width: 380px;
    height: 380px;
    object-fit: contain;
    filter: drop-shadow(0 0 20px rgba(0,170,255,0.9))
            drop-shadow(0 0 60px rgba(0,170,255,0.9));
}

@keyframes float {
    0%,100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
}

/* RESULT SECTION */
.result-section {
    display: none;
    background: #111;
    padding: 30px;
    border-radius: 15px;
    margin-top: 20px;
    border: 1px solid #00aaff;
    box-shadow: 0 0 20px rgba(0,170,255,0.3);
}

.result-section.show {
    display: block;
    animation:fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
.prediction {
    font-size: 22px;
    font-weight: bold;
    padding: 15px;
    text-align: center;
    border-radius: 8px;
    margin-bottom: 20px;
}

.fraud {
    background: #330000;
    color: #ff4d4d;
    border: 1px solid red;
}

.legitimate {
    background: #002200;
    color: #00ccff;
    border: 1px solid #00aaff;
}

.result-item {
    padding: 12px;
    background: #1a1a1a;
    border-left: 4px solid #00aaff;
    margin-bottom: 12px;
    border-radius: 5px;
}

.result-item strong {
    color: white;
}
.result-item span {
    color: #ccc;
}

/* BACK BUTTON */
.back-button {
    display: inline-block;
    margin-bottom: 20px;
    color: #ff4d4d;
    text-decoration: none;
    font-weight: 600;
}

.back-button:hover {
    text-decoration: underline;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="form-section">
            <a href="/" class="back-button">← Back to Home</a>
            <h1>Online Payments Fraud Detection</h1>
            <p class="subtitle">Enter transaction details to check for fraud</p>

            <form id="predictionForm" method="POST" action="/predict">
                <div class="form-group">
                    <label for="step">Step</label>
                    <input 
                        type="number" 
                        id="step" 
                        name="step" 
                        placeholder="Step represents a unit of time when" 
                        required 
                        min="1"
                    >
                </div>

                <div class="form-group">
                    <label for="type">Type</label>
                    <select id="type" name="type" required>
                        <option value="">Type of online transaction</option>
                        <option value="CASH_IN">CASH_IN</option>
                        <option value="CASH_OUT">CASH_OUT</option>
                        <option value="DEBIT">DEBIT</option>
                        <option value="PAYMENT">PAYMENT</option>
                        <option value="TRANSFER">TRANSFER</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input 
                        type="number" 
                        id="amount" 
                        name="amount" 
                        placeholder="The amount of the transaction" 
                        required 
                        step="any"
                        min="0"
                    >
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="oldbalanceOrg">OldbalanceOrg</label>
                        <input 
                            type="number" 
                            id="oldbalanceOrg" 
                            name="oldbalanceOrg" 
                            placeholder="Balance before transaction" 
                            required 
                            step="any"
                            min="0"
                        >
                    </div>
                    <div class="form-group">
                        <label for="newbalanceOrig">NewbalanceOrig</label>
                        <input 
                            type="number" 
                            id="newbalanceOrig" 
                            name="newbalanceOrig" 
                            placeholder="Balance after transaction" 
                            required 
                            step="any"
                            min="0"
                        >
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="oldbalanceDest">OldbalanceDest</label>
                        <input 
                            type="number" 
                            id="oldbalanceDest" 
                            name="oldbalanceDest" 
                            placeholder="Initial balance of recipient" 
                            required 
                            step="any"
                            min="0"
                        >
                    </div>
                    <div class="form-group">
                        <label for="newbalanceDest">NewbalanceDest</label>
                        <input 
                            type="number" 
                            id="newbalanceDest" 
                            name="newbalanceDest" 
                            placeholder="The new balance of recipient after tx" 
                            required 
                            step="any"
                            min="0"
                        >
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-submit">Predict</button>
                    <button type="reset" class="btn-reset">Clear</button>
                </div>
            </form>

            <div id="resultSection" class="result-section">
                <div id="predictionResult" class="prediction"></div>
                <div id="resultDetails"></div>
            </div>
        </div>

        <div class="graphics-section">
            <div class="security-icon">
                <img src="{{ url_for('static', filename='images/shield.png') }}" alt="Shield logo" />
            </div>
        </div>
    </div>

    <script>
       
    const form = document.getElementById('predictionForm');
    const resultSection = document.getElementById('resultSection');

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData(this);
        const transactionType = formData.get('type');
        
        if (!transactionType) {
            alert('Please select a transaction type');
            return;
        }

        const step = parseFloat(formData.get('step'));
        const amount = parseFloat(formData.get('amount'));
        const oldbalanceOrg = parseFloat(formData.get('oldbalanceOrg'));
        const newbalanceOrig = parseFloat(formData.get('newbalanceOrig'));
        const oldbalanceDest = parseFloat(formData.get('oldbalanceDest'));
        const newbalanceDest = parseFloat(formData.get('newbalanceDest'));

        if (isNaN(step) || isNaN(amount) || isNaN(oldbalanceOrg) || isNaN(newbalanceOrig) || 
            isNaN(oldbalanceDest) || isNaN(newbalanceDest)) {
            alert('Please enter valid numbers for all fields');
            return;
        }

        const data = {
            step: step,
            type: transactionType,
            amount: amount,
            oldbalanceOrg: oldbalanceOrg,
            newbalanceOrig: newbalanceOrig,
            oldbalanceDest: oldbalanceDest,
            newbalanceDest: newbalanceDest,
            isFlaggedFraud: 0
        };

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Prediction failed');
            }

            const result = await response.json();
            showResult(result, transactionType, amount);

        } catch (error) {
            alert('Error making prediction: ' + error.message);
        }
    });

    function showResult(result, type, amount) {
        const predictionResult = document.getElementById('predictionResult');
        const resultDetails = document.getElementById('resultDetails');

        const pred = Number(result.prediction);

        let predictionText, predictionClass;

        if (pred === 1) {
            predictionText = '⚠️ FRAUD DETECTED';
            predictionClass = 'fraud';
        } else {
            predictionText = '✅ NOT FRAUD';   // ✅ Fixed typo
            predictionClass = 'legitimate';
        }

        predictionResult.textContent = predictionText;
        predictionResult.className = 'prediction ' + predictionClass;

        const confidence = (result.probability !== null && result.probability !== undefined)
            ? (Number(result.probability) * 100).toFixed(2)
            : 'N/A';

        const amountText = (typeof amount === 'number' && !isNaN(amount)) 
            ? `$${amount.toFixed(2)}` 
            : 'N/A';

        resultDetails.innerHTML = `
            <div class="result-item">
                <strong>Confidence:</strong>
                <span>${confidence === 'N/A' ? 'N/A' : confidence + '%'}</span>
            </div>
            <div class="result-item">
                <strong>Transaction Type:</strong>
                <span>${type}</span>
            </div>
            <div class="result-item">
                <strong>Amount:</strong>
                <span>${amountText}</span>
            </div>
        `;

        resultSection.classList.add('show');
        resultSection.scrollIntoView({ behavior: 'smooth' });
    }

    // ✅ FIX: Hide result when Clear button is clicked
    form.addEventListener('reset', function() {
        resultSection.classList.remove('show');
    });

    </script>
</body>
</html>